<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¡”ç½—å·¥åŠ - è‡ªå®šä¹‰å›¾æºç‰ˆ</title>
    <style>
        :root {
            --primary-color: #e0c097;
            --bg-gradient: radial-gradient(circle at center, #1a002a 0%, #050008 100%);
            --card-back-pattern: repeating-linear-gradient(45deg, #4a2c5a, #4a2c5a 2px, #2a0c3a 2px, #2a0c3a 4px);
        }

        body {
            background: var(--bg-gradient);
            color: var(--primary-color);
            font-family: 'STKaiti', 'Georgia', serif;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; margin: 0; padding: 5px; 
            padding-bottom: 160px; /* ç»™åº•éƒ¨æ ç•™ä½ç½® */
            overflow-x: hidden;
        }

        h1 { font-size: 1.1rem; margin: 8px 0; text-shadow: 0 0 8px rgba(224, 192, 151, 0.5); }

        /* æŒ‰é’®ç»„ */
        .nav-group { display: flex; gap: 6px; margin-bottom: 8px; flex-wrap: wrap; justify-content: center; }
        .nav-btn {
            background: rgba(90, 56, 117, 0.3); border: 1px solid var(--primary-color);
            color: var(--primary-color); padding: 5px 12px; border-radius: 4px;
            cursor: pointer; font-size: 12px; transition: 0.2s;
        }
        .nav-btn.active { background: var(--primary-color); color: #1a002a; font-weight: bold; }
        
        .action-btn {
            background: linear-gradient(45deg, #5a3875, #8a58a8); border: none;
            color: white; padding: 6px 20px; border-radius: 15px;
            cursor: pointer; font-size: 13px; box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }

        #status-bar { margin-bottom: 5px; color: #b893cc; font-size: 12px; height: 16px; text-align: center;}

        /* === è‡ªç”±æ¨¡å¼ï¼šåº•éƒ¨ç»“æœæ  === */
        #free-result-bar {
            position: fixed; bottom: 0; left: 0; width: 100%;
            height: 140px; background: rgba(10, 0, 15, 0.95);
            border-top: 1px solid #5a3875;
            z-index: 100;
            display: none; /* é»˜è®¤éšè— */
            flex-direction: row; align-items: center;
            overflow-x: auto; padding: 0 10px; gap: 10px;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.5);
        }
        .free-card-show {
            flex: 0 0 auto; width: 70px; display: flex; flex-direction: column; align-items: center;
            animation: slideIn 0.3s ease-out;
        }
        .free-card-img {
            width: 70px; height: 115px; border-radius: 4px; border: 1px solid var(--primary-color);
            overflow: hidden; background: #000;
        }
        .free-card-img img { width: 100%; height: 100%; object-fit: cover; }
        .free-card-name { font-size: 10px; margin-top: 4px; text-align: center; color: #fff; white-space: nowrap; }

        /* === ç‰Œæ¡Œç½‘æ ¼ (æå°ç‰ŒèƒŒ) === */
        #deck-grid {
            display: grid; 
            grid-template-columns: repeat(13, 1fr); /* 13åˆ—ï¼ŒæŒ‡ç”²ç›–å¤§å° */
            gap: 2px; width: 98vw; max-width: 600px;
            padding-bottom: 20px;
        }
        .grid-yesno { grid-template-columns: repeat(7, 1fr) !important; gap: 4px !important; }

        .card-slot {
            aspect-ratio: 2/3.5; position: relative; cursor: pointer;
            border-radius: 2px; overflow: hidden;
            background: var(--card-back-pattern);
            border: 1px solid #3a1c4a;
            transition: opacity 0.3s;
        }
        /* è‡ªç”±æ¨¡å¼é€‰ä¸­åå˜æš— */
        .card-slot.selected { opacity: 0.1; pointer-events: none; }

        /* é€†ä½æ—‹è½¬ */
        img.reversed { transform: rotate(180deg); }

        /* ç»“æœåŒº */
        .result-container { display: flex; justify-content: center; gap: 8px; width: 100%; flex-wrap: wrap;}
        .tri-card { width: 28vw; max-width: 100px; text-align: center; animation: fadeIn 0.5s forwards; }
        .tri-img { 
            aspect-ratio: 2/3.5; border: 1px solid var(--primary-color); 
            border-radius: 4px; overflow: hidden; background: #220033;
        }
        .tri-img img { width: 100%; height: 100%; object-fit: cover; }
        .tri-label { font-size: 12px; margin-bottom: 4px; color: #b893cc; font-weight: bold; }

        /* YesNo ç»“æœæ¡† */
        .yn-box {
            background: rgba(30,0,50,0.9); border: 1px solid #5a3875;
            padding: 15px; border-radius: 12px; text-align: center; width: 85%;
            margin-top: 10px; animation: fadeIn 0.5s;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateX(20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

    </style>
</head>
<body>

    <h1>ğŸ”® å¡”ç½—åœ¨çº¿å·¥åŠ</h1>
    
    <div class="nav-group">
        <button class="nav-btn active" id="tab-triangle" onclick="switchTab('triangle')">åœ£ä¸‰è§’</button>
        <button class="nav-btn" id="tab-free" onclick="switchTab('free')">è‡ªç”±é€‰ç‰Œ</button>
        <button class="nav-btn" id="tab-yesno" onclick="switchTab('yesno')">Yes / No</button>
    </div>

    <div id="ctrl-triangle" class="nav-group">
        <button onclick="setTriangleMode('random')" id="btn-tri-rnd" class="nav-btn active">éšæœºæŠ½3å¼ </button>
        <button onclick="setTriangleMode('manual')" id="btn-tri-man" class="nav-btn">æ‰‹åŠ¨é€‰3å¼ </button>
        <button id="btn-tri-go" class="action-btn" onclick="executeTriangleDraw()">å¼€å§‹è§£è¯»</button>
    </div>

    <div id="ctrl-free" class="nav-group" style="display:none;">
        <button onclick="drawRandomFree()" class="action-btn">ğŸ² éšæœºæŠ½ä¸€å¼ </button>
        <button onclick="resetFree()" class="nav-btn">é‡ç½®ç‰Œæ¡Œ</button>
    </div>

    <div id="status-bar">å‡†å¤‡å°±ç»ª</div>

    <div id="free-result-bar">
        <div style="color:#666; font-size:12px; width:100%; text-align:center;">
            (ç‚¹é€‰å°ç‰ŒèƒŒï¼Œæˆ–ç‚¹å‡»éšæœºæŠ½å–ï¼Œç‰Œä¼šåˆ—åœ¨è¿™é‡Œ)
        </div>
    </div>

    <div class="result-container" id="results"></div>

    <div id="deck-grid"></div>

<script>
    // 1. ç½‘ç»œå›¾æºåŠ é€Ÿå‡½æ•° (ç”¨äºéå®«å»·ç‰Œ)
    const getFastImgUrl = (path) => `https://wsrv.nl/?url=https://upload.wikimedia.org/wikipedia/commons/${path}&w=160&output=webp&q=75`;

    // 2. æœ¬åœ°/è‡ªå®šä¹‰å›¾æºè·¯å¾„ (ç”¨äºå®«å»·ç‰Œ)
    // ã€æ ¸å¿ƒä¿®å¤ã€‘ï¼šå›¾ç‰‡å°±åœ¨æ ¹ç›®å½•ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ ./${filename}
    const getCourtCardUrl = (filename) => `./${filename}`;
    // === æ•°æ®å®šä¹‰ ===
    const tarotData = [
        // --- å¤§é˜¿å¡çº³ (ä¿æŒç½‘ç»œæº) ---
        {id: 0, name: "æ„šè€…", path: "9/90/RWS_Tarot_00_Fool.jpg"},
        {id: 1, name: "é­”æœ¯å¸ˆ", path: "d/de/RWS_Tarot_01_Magician.jpg"},
        {id: 2, name: "å¥³æ•™çš‡", path: "8/88/RWS_Tarot_02_High_Priestess.jpg"},
        {id: 3, name: "çš‡å", path: "d/d2/RWS_Tarot_03_Empress.jpg"},
        {id: 4, name: "çš‡å¸", path: "c/c3/RWS_Tarot_04_Emperor.jpg"},
        {id: 5, name: "æ•™çš‡", path: "8/8d/RWS_Tarot_05_Hierophant.jpg"},
        {id: 6, name: "æ‹äºº", path: "3/3a/TheLovers.jpg"},
        {id: 7, name: "æˆ˜è½¦", path: "9/9b/RWS_Tarot_07_Chariot.jpg"},
        {id: 8, name: "åŠ›é‡", path: "f/f5/RWS_Tarot_08_Strength.jpg"},
        {id: 9, name: "éšå£«", path: "4/4d/RWS_Tarot_09_Hermit.jpg"},
        {id: 10, name: "å‘½è¿ä¹‹è½®", path: "3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg"},
        {id: 11, name: "æ­£ä¹‰", path: "e/e0/RWS_Tarot_11_Justice.jpg"},
        {id: 12, name: "å€’åŠäºº", path: "2/2b/RWS_Tarot_12_Hanged_Man.jpg"},
        {id: 13, name: "æ­»ç¥", path: "d/d7/RWS_Tarot_13_Death.jpg"},
        {id: 14, name: "èŠ‚åˆ¶", path: "f/f8/RWS_Tarot_14_Temperance.jpg"},
        {id: 15, name: "æ¶é­”", path: "5/55/RWS_Tarot_15_Devil.jpg"},
        {id: 16, name: "é«˜å¡”", path: "5/53/RWS_Tarot_16_Tower.jpg"},
        {id: 17, name: "æ˜Ÿæ˜Ÿ", path: "d/db/RWS_Tarot_17_Star.jpg"},
        {id: 18, name: "æœˆäº®", path: "7/7f/RWS_Tarot_18_Moon.jpg"},
        {id: 19, name: "å¤ªé˜³", path: "1/17/RWS_Tarot_19_Sun.jpg"},
        {id: 20, name: "å®¡åˆ¤", path: "d/dd/RWS_Tarot_20_Judgement.jpg"},
        {id: 21, name: "ä¸–ç•Œ", path: "f/ff/RWS_Tarot_21_World.jpg"},

        // --- æƒæ– (1-10ç½‘ç»œï¼Œå®«å»·æœ¬åœ°) ---
        {id: 22, name: "æƒæ–ä¸€", path: "1/11/Wands01.jpg"}, {id: 23, name: "æƒæ–äºŒ", path: "0/0f/Wands02.jpg"},
        {id: 24, name: "æƒæ–ä¸‰", path: "f/ff/Wands03.jpg"}, {id: 25, name: "æƒæ–å››", path: "a/a4/Wands04.jpg"},
        {id: 26, name: "æƒæ–äº”", path: "9/9d/Wands05.jpg"}, {id: 27, name: "æƒæ–å…­", path: "3/3b/Wands06.jpg"},
        {id: 28, name: "æƒæ–ä¸ƒ", path: "e/e4/Wands07.jpg"}, {id: 29, name: "æƒæ–å…«", path: "6/6b/Wands08.jpg"},
        {id: 30, name: "æƒæ–ä¹", path: "e/e3/Wands09.jpg"}, {id: 31, name: "æƒæ–å", path: "0/0b/Wands10.jpg"},
        {id: 32, name: "æƒæ–ä¾ä»", local: "w_page.jpg"},   {id: 33, name: "æƒæ–éª‘å£«", local: "w_knight.jpg"},
        {id: 34, name: "æƒæ–ç‹å", local: "w_queen.jpg"},  {id: 35, name: "æƒæ–å›½ç‹", local: "w_king.jpg"},

        // --- åœ£æ¯ ---
        {id: 36, name: "åœ£æ¯ä¸€", path: "3/36/Cups01.jpg"}, {id: 37, name: "åœ£æ¯äºŒ", path: "f/f8/Cups02.jpg"},
        {id: 38, name: "åœ£æ¯ä¸‰", path: "7/7a/Cups03.jpg"}, {id: 39, name: "åœ£æ¯å››", path: "3/35/Cups04.jpg"},
        {id: 40, name: "åœ£æ¯äº”", path: "d/d7/Cups05.jpg"}, {id: 41, name: "åœ£æ¯å…­", path: "1/17/Cups06.jpg"},
        {id: 42, name: "åœ£æ¯ä¸ƒ", path: "a/ae/Cups07.jpg"}, {id: 43, name: "åœ£æ¯å…«", path: "6/60/Cups08.jpg"},
        {id: 44, name: "åœ£æ¯ä¹", path: "2/24/Cups09.jpg"}, {id: 45, name: "åœ£æ¯å", path: "8/84/Cups10.jpg"},
        {id: 46, name: "åœ£æ¯ä¾ä»", local: "c_page.jpg"},   {id: 47, name: "åœ£æ¯éª‘å£«", local: "c_knight.jpg"},
        {id: 48, name: "åœ£æ¯ç‹å", local: "c_queen.jpg"},  {id: 49, name: "åœ£æ¯å›½ç‹", local: "c_king.jpg"},

        // --- å®å‰‘ ---
        {id: 50, name: "å®å‰‘ä¸€", path: "1/1a/Swords01.jpg"}, {id: 51, name: "å®å‰‘äºŒ", path: "9/92/Swords02.jpg"},
        {id: 52, name: "å®å‰‘ä¸‰", path: "2/2c/Swords03.jpg"}, {id: 53, name: "å®å‰‘å››", path: "b/bf/Swords04.jpg"},
        {id: 54, name: "å®å‰‘äº”", path: "2/23/Swords05.jpg"}, {id: 55, name: "å®å‰‘å…­", path: "2/29/Swords06.jpg"},
        {id: 56, name: "å®å‰‘ä¸ƒ", path: "3/34/Swords07.jpg"}, {id: 57, name: "å®å‰‘å…«", path: "a/a7/Swords08.jpg"},
        {id: 58, name: "å®å‰‘ä¹", path: "2/2f/Swords09.jpg"}, {id: 59, name: "å®å‰‘å", path: "d/d4/Swords10.jpg"},
        {id: 60, name: "å®å‰‘ä¾ä»", local: "s_page.jpg"},   {id: 61, name: "å®å‰‘éª‘å£«", local: "s_knight.jpg"},
        {id: 62, name: "å®å‰‘ç‹å", local: "s_queen.jpg"},  {id: 63, name: "å®å‰‘å›½ç‹", local: "s_king.jpg"},

        // --- æ˜Ÿå¸ ---
        {id: 64, name: "æ˜Ÿå¸ä¸€", path: "f/fd/Pents01.jpg"}, {id: 65, name: "æ˜Ÿå¸äºŒ", path: "9/9f/Pents02.jpg"},
        {id: 66, name: "æ˜Ÿå¸ä¸‰", path: "4/42/Pents03.jpg"}, {id: 67, name: "æ˜Ÿå¸å››", path: "3/35/Pents04.jpg"},
        {id: 68, name: "æ˜Ÿå¸äº”", path: "9/96/Pents05.jpg"}, {id: 69, name: "æ˜Ÿå¸å…­", path: "a/a6/Pents06.jpg"},
        {id: 70, name: "æ˜Ÿå¸ä¸ƒ", path: "6/6a/Pents07.jpg"}, {id: 71, name: "æ˜Ÿå¸å…«", path: "4/49/Pents08.jpg"},
        {id: 72, name: "æ˜Ÿå¸ä¹", path: "f/f0/Pents09.jpg"}, {id: 73, name: "æ˜Ÿå¸å", path: "4/42/Pents10.jpg"},
        {id: 74, name: "æ˜Ÿå¸ä¾ä»", local: "p_page.jpg"},   {id: 75, name: "æ˜Ÿå¸éª‘å£«", local: "p_knight.jpg"},
        {id: 76, name: "æ˜Ÿå¸ç‹å", local: "p_queen.jpg"},  {id: 77, name: "æ˜Ÿå¸å›½ç‹", local: "p_king.jpg"}
    ];

    // === è·å–å›¾ç‰‡åœ°å€çš„é€»è¾‘ ===
    function getCardSrc(cardData) {
        if (cardData.local) {
            // å¦‚æœæ˜¯å®«å»·ç‰Œï¼Œä½¿ç”¨æœ¬åœ°è·¯å¾„
            return getCourtCardUrl(cardData.local);
        } else {
            // å¦åˆ™ä½¿ç”¨ç½‘ç»œåŠ é€Ÿè·¯å¾„
            return getFastImgUrl(cardData.path);
        }
    }

    const ynRules = {
        22: 'WAIT', 36: 'WAIT', 50: 'WAIT', 64: 'WAIT',
        44: 'YES', 0: 'YES', 1: 'YES', 3: 'YES', 4: 'YES', 7: 'YES', 11: 'YES', 17: 'YES', 19: 'YES', 21: 'YES',
        8: 'NO', 16: 'NO', 14: 'NO', 9: 'NO', 12: 'NO', 13: 'NO', 15: 'NO'
    };
    const ynText = { 'YES': 'æ˜ç¡®çš„æ˜¯', 'NO': 'æ˜ç¡®çš„å¦', 'WAIT': 'ç­‰å¾…æ—¶æœºå®‰æ’', 'OPEN': 'ä¸åˆ†æ˜¯å¦ï¼Œç›´è§‰è§£ç­”' };

    let currentTab = 'triangle';
    let triangleMode = 'random';
    let shuffledIndices = [];
    let freeSelectedCount = 0;

    function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`tab-${tab}`).classList.add('active');

        // éšè—æ‰€æœ‰ç»“æœå’Œæ§ä»¶
        document.getElementById('deck-grid').className = ''; 
        document.getElementById('deck-grid').innerHTML = '';
        document.getElementById('results').innerHTML = '';
        document.getElementById('ctrl-triangle').style.display = 'none';
        document.getElementById('ctrl-free').style.display = 'none';
        document.getElementById('free-result-bar').style.display = 'none';
        document.body.style.paddingBottom = '20px';

        if(tab === 'triangle') {
            document.getElementById('ctrl-triangle').style.display = 'flex';
            setTriangleMode('random');
        } else if(tab === 'free') {
            document.getElementById('ctrl-free').style.display = 'flex';
            document.body.style.paddingBottom = '160px'; // ç•™å‡ºåº•éƒ¨ç©ºé—´
            initFree();
        } else if(tab === 'yesno') {
            initYesNo();
        }
    }

    // === è‡ªç”±æ¨¡å¼ ===
    function initFree() {
        document.getElementById('status-bar').innerText = 'è‡ªç”±æ¨¡å¼ï¼šå¯ç‚¹ç‰ŒæŠ½é€‰ï¼Œæˆ–ç‚¹æŒ‰é’®éšæœºæŠ½';
        document.getElementById('free-result-bar').style.display = 'flex';
        document.getElementById('free-result-bar').innerHTML = '<div style="color:#aaa; font-size:12px; width:100%; text-align:center;">(é€‰ä¸­çš„ç‰Œå°†æŒ‰é¡ºåºå‡ºç°åœ¨è¿™é‡Œ)</div>';
        freeSelectedCount = 0;
        
        shuffledIndices = shuffle(Array.from({length: 78}, (_, i) => i));
        const grid = document.getElementById('deck-grid');
        grid.innerHTML = '';
        
        for(let i=0; i<78; i++) {
            const slot = document.createElement('div');
            slot.className = 'card-slot';
            // è‡ªç”±æ¨¡å¼ï¼Œç‚¹å‡»ç‰ŒèƒŒç›´æ¥é€‰
            slot.onclick = () => pickFreeCard(i, slot);
            grid.appendChild(slot);
        }
    }

    function resetFree() {
        if(confirm("ç¡®å®šè¦æ¸…ç©ºå½“å‰ç‰Œé˜µå—ï¼Ÿ")) initFree();
    }

    function pickFreeCard(idx, slot) {
        if(slot.classList.contains('selected')) return;
        slot.classList.add('selected'); // ç‰ŒèƒŒå˜æš—æ¶ˆå¤±
        addCardToFreeResult(shuffledIndices[idx]);
    }

    function drawRandomFree() {
        const availableSlots = Array.from(document.querySelectorAll('.card-slot:not(.selected)'));
        if(availableSlots.length === 0) {
            alert("ç‰Œéƒ½æŠ½å®Œå•¦ï¼");
            return;
        }
        const randomSlot = availableSlots[Math.floor(Math.random() * availableSlots.length)];
        randomSlot.click(); 
    }

    function addCardToFreeResult(cardId) {
        const bar = document.getElementById('free-result-bar');
        if(freeSelectedCount === 0) bar.innerHTML = '';
        freeSelectedCount++;

        const data = tarotData.find(d => d.id === cardId);
        const isRev = Math.random() > 0.5;

        const cardDiv = document.createElement('div');
        cardDiv.className = 'free-card-show';
        cardDiv.innerHTML = `
            <div class="free-card-img">
                <img src="${getCardSrc(data)}" class="${isRev ? 'reversed' : ''}">
            </div>
            <div class="free-card-name">${freeSelectedCount}. ${data.name}${isRev?'(é€†)':''}</div>
        `;
        bar.appendChild(cardDiv);
        bar.scrollLeft = bar.scrollWidth;
    }

    // === Yes/No æ¨¡å¼ ===
    function initYesNo() {
        document.getElementById('status-bar').innerText = 'Yes/Noï¼šè¯·ç‚¹å‡»ä¸€å¼ ';
        const grid = document.getElementById('deck-grid');
        grid.className = 'grid-yesno';
        grid.innerHTML = '';
        
        const deck27 = [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21, 22,36,50,64, 44];
        shuffledIndices = shuffle(deck27);
        
        for(let i=0; i<27; i++) {
            const slot = document.createElement('div');
            slot.className = 'card-slot';
            slot.onclick = () => renderYesNoResult(shuffledIndices[i]);
            grid.appendChild(slot);
        }
    }

    function renderYesNoResult(id) {
        document.getElementById('deck-grid').innerHTML = '';
        const data = tarotData.find(d => d.id === id);
        const type = ynRules[id] || 'OPEN';
        const color = {'YES':'#4caf50','NO':'#f44336','WAIT':'#ff9800','OPEN':'#9c27b0'}[type];
        
        document.getElementById('results').innerHTML = `
            <div class="tri-card" style="width:120px">
                <div class="tri-img"><img src="${getCardSrc(data)}"></div>
                <div class="tri-label" style="margin-top:5px">${data.name}</div>
            </div>
            <div class="yn-box" style="border-color:${color}">
                <div class="yn-title" style="color:${color}">${type}</div>
                <div style="color:#ddd; font-size:14px;">${ynText[type]}</div>
                <button class="nav-btn" style="margin-top:15px; border-color:#fff; color:#fff;" onclick="initYesNo()">å†è¯•ä¸€æ¬¡</button>
            </div>`;
    }

    // === åœ£ä¸‰è§’ ===
    let triPicks = [];
    function setTriangleMode(mode) {
        triangleMode = mode;
        const btnRnd = document.getElementById('btn-tri-rnd');
        const btnMan = document.getElementById('btn-tri-man');
        const btnGo = document.getElementById('btn-tri-go');
        const grid = document.getElementById('deck-grid');

        btnRnd.classList.toggle('active', mode === 'random');
        btnMan.classList.toggle('active', mode === 'manual');
        grid.innerHTML = ''; document.getElementById('results').innerHTML = '';

        if(mode === 'manual') {
            btnGo.style.display = 'none';
            document.getElementById('status-bar').innerText = 'è¯·ä»ä¸‹æ–¹é€‰å– 3 å¼ ';
            shuffledIndices = shuffle(Array.from({length: 78}, (_, i) => i));
            triPicks = [];
            
            for(let i=0; i<78; i++) {
                const slot = document.createElement('div');
                slot.className = 'card-slot';
                slot.onclick = () => {
                    if(triPicks.length < 3 && !slot.classList.contains('selected')) {
                        slot.classList.add('selected');
                        triPicks.push(shuffledIndices[i]);
                        document.getElementById('status-bar').innerText = `å·²é€‰ ${triPicks.length} / 3`;
                        if(triPicks.length === 3) { 
                            grid.innerHTML = ''; 
                            renderTriangle(triPicks); 
                        }
                    }
                };
                grid.appendChild(slot);
            }
        } else {
            btnGo.style.display = 'inline-block';
            document.getElementById('status-bar').innerText = 'ç‚¹å‡»å¼€å§‹è§£è¯»';
        }
    }

    function executeTriangleDraw() {
        const ids = shuffle(Array.from({length: 78}, (_, i) => i)).slice(0,3);
        renderTriangle(ids);
    }

    function renderTriangle(ids) {
        const container = document.getElementById('results');
        const labs = ['è¿‡å»', 'ç°åœ¨', 'æœªæ¥'];
        container.innerHTML = ids.map((id, i) => {
            const d = tarotData.find(x => x.id === id);
            const isRev = Math.random() > 0.5;
            return `
            <div class="tri-card">
                <div class="tri-label">${labs[i]}</div>
                <div class="tri-img">
                    <img src="${getCardSrc(d)}" class="${isRev?'reversed':''}">
                </div>
                <div class="tri-label" style="font-size:10px; margin-top:4px;">${d.name}${isRev?'(é€†)':''}</div>
            </div>`;
        }).join('');
        document.getElementById('status-bar').innerText = 'è§£è¯»å®Œæˆ';
    }

    function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

    window.onload = () => switchTab('triangle');
</script>
</body>
</html>
